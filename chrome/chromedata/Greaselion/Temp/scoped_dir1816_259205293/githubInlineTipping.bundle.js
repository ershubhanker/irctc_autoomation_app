(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t;let o=!1;const s=()=>"complete"===document.readyState&&"visible"===document.visibilityState,i="github",r=async e=>{if(!e)throw new Error("Invalid parameters");const t=(e=>e?`https://api.github.com/users/${e}`:"")(e);if(!t)throw new Error("Invalid profile api url");const n=await fetch(t);if(!n.ok){const e=((e,t)=>`Profile API request failed: ${t.statusText} (${t.status})`)(0,n);throw new Error(e)}const o=await n.json();return{user:{id:o.id,screenName:o.login,fullName:o.name||o.login,favIconUrl:o.avatar_url},post:{id:"",timestamp:"",text:""}}},l="action-brave-tip",a="GitHubTip-actionCount",c="IconContainer";let d=null;const m=(e,t)=>{const o=document.createElement("div");o.className="GitHubTip-action js-tooltip "+l,o.style.display="inline-block",o.style.minWidth="40px";const s=chrome.i18n.getMessage("githubTipsHoverText");s&&(o.className+=" tooltipped tooltipped-sw",o.setAttribute("aria-label",s));const r=document.createElement("button");r.className="GitHubTip-actionButton u-textUserColorHover js-actionButton",r.style.background="transparent",r.style.border="0",r.style.color="#657786",r.style.cursor="pointer",r.style.display="inline-block",r.style.fontSize="16px",r.style.lineHeight="1",r.style.outline="0",r.style.padding="0 2px",r.style.position="relative",r.type="button",r.onclick=function(o){return o.stopPropagation(),t(e).then((e=>{e&&(e=>{if(!e)return;const t=(o=e.user.screenName)?`https://github.com/${o}/`:"";var o;const s=((e,t)=>`${e}#channel:${t}`)(i,e.user.id),r=e.user.fullName,l=e.user.screenName,a=n();a&&a.postMessage({type:"TipUser",mediaType:i,data:{url:t,publisherKey:s,publisherName:r,publisherScreenName:l,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})})(e)}))};const d=document.createElement("div");d.className=c+" js-tooltip",d.style.display="inline-block",d.style.lineHeight="0",d.style.position="relative",d.style.verticalAlign="middle",r.appendChild(d);const m=document.createElement("span");m.className="Icon Icon--medium",m.style.background="transparent",m.style.content=`url("data:image/svg+xml,${encodeURIComponent('<svg fill="inherit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.821 11.1L8.075 6.732v-2.38l4.917 8.195-2.17-1.447zm-6.03.965h5.397l1.752 1.168H2.747l2.043-1.168zm2.13-5.333L4.187 11.08l-1.983 1.133 4.717-7.861v2.38zm.577 1.251l1.841 2.928H5.657l1.841-2.928zm7.42 5.53L7.993 1.97c-.018-.03-.043-.054-.066-.08a.568.568 0 00-.429-.2.57.57 0 00-.43.2c-.022.026-.047.05-.064.08L.079 13.513a.59.59 0 00-.061.143c-.002.004-.002.007-.002.01a.571.571 0 00-.008.237.56.56 0 00.064.193c.01.017.023.029.034.044.02.026.037.055.06.077.021.022.047.038.071.057.017.011.031.025.048.035.027.016.056.025.085.036.018.007.035.016.054.022a.597.597 0 00.132.017c.006 0 .012.003.017.003h13.85a.576.576 0 00.495-.874z" fill="#6A7684"/></svg>')}")`,m.style.display="inline-block",m.style.fontSize="18px",m.style.fontStyle="normal",m.style.height="16px",m.style.marginTop="3px",m.style.position="relative",m.style.verticalAlign="baseline",m.style.width="16px",d.appendChild(m);const p=document.createElement("span");p.className=a,p.style.color="#657786",p.style.display="inline-block",p.style.fontSize="12px",p.style.fontWeight="bold",p.style.lineHeight="1",p.style.marginLeft="1px",p.style.position="relative",p.style.verticalAlign="text-bottom",r.appendChild(p);const h=document.createElement("span");h.className="GitHubTip-actionCountForPresentation";const u=chrome.i18n.getMessage("githubTipsIconLabel");u&&(h.textContent=u),p.appendChild(h);const f=o.attachShadow({mode:"open"});f.appendChild(r);const g=document.createElement("style");return g.appendChild(document.createTextNode(".GitHubTip-actionButton :hover { color: #6781db }")),f.appendChild(g),o},p=async e=>{let t=e.closest(".timeline-comment-header");if(t=t||e.closest(".review-comment"),!t)throw new Error("Failed to parse DOM");const n=t.getElementsByClassName("author");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0].textContent;if(!o)throw new Error("Missing screen name");return r(o)},h=e=>{if(!e)return;const t=m(e,p);if(!t||!t.shadowRoot)return;t.style.marginRight="2px";const n=t.shadowRoot.querySelector(`.${c}`);n&&(n.style.paddingBottom="5px");const o=t.shadowRoot.querySelector(`.${a}`);o&&(o.style.paddingBottom="2px");const s=e.childNodes;if(!s||s.length<2)return;const i=s[s.length-2];e.insertBefore(t,i)},u=async e=>{if(!e)throw new Error("Invalid arguments");const t=e.getElementsByClassName("avatar");if(!t||0===t.length)throw new Error("Failed to parse DOM");const n=t[0];if(!n)throw new Error("Failed to parse DOM");const o=n.children;if(!o||0===o.length)throw new Error("Failed to parse DOM");const s=o[0].alt.slice(1);if(!s)throw new Error("Missing screen name");return r(s)},f=e=>{if(!e)return;const t=m(e,u);t&&(t.style.marginTop="4px",t.style.marginLeft="9px",e.appendChild(t))},g=async e=>{if(!e)throw new Error("Invalid arguments");const t=e.closest(".d-block");if(!t)throw new Error("Failed to parse DOM");const n=t.getElementsByTagName("A");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0];if(!o.href)throw new Error("Failed to parse DOM");const s=o.href.split("/");if(s.length<4)throw new Error("Failed to parse DOM");const i=s[3];if(!i)throw new Error("Missing screen name");return r(i)},y=e=>{if(!e)return;if(!(e=>{if(!e)return!1;const t=new URLSearchParams(e);if(!t||!t.has("tab"))return!1;const n=t.get("tab");return!!n&&!!["stars"].includes(n)})(window.location.search))return;const t=e.getElementsByClassName("d-inline-block");if(!t||0===t.length)return;const n=m(e,g);n.classList.add("d-inline-block"),n.style.minWidth="60px",e.insertBefore(n,t[0])},w=async e=>{const t=document.getElementsByClassName("gisthead");if(!t||0===t.length)throw new Error("Failed to parse DOM");const n=t[0].getElementsByClassName("author");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0].getElementsByTagName("A");if(!o||0===o.length)throw new Error("Failed to parse DOM");const s=o[0].textContent;if(!s)throw new Error("Missing screen name");return r(s)},b=e=>{if(!e)return;const t=window.location.host.split(".");if(!t||t.length<1)return;if("gist"!==t[0]||window.location.pathname.slice(1).split("/").length<2)return;const n=m(e,w);e.appendChild(n)},E=async e=>{if(!e)throw new Error("Invalid arguments");const t=e;if(!t.href)throw new Error("Failed to parse DOM");const n=t.href.replace("https://github.com","");if(!n)throw new Error("Failed to parse DOM");const o=n.split("/").filter((e=>e));if(o.length<1)throw new Error("Failed to parse DOM");let s="";if(s="orgs"===o[0]?o[o.length-1]:o[0],!s)throw new Error("Missing screen name");return r(s)},v=e=>{if(!e||!e.children||e.children.length<2)return;const t=window.location.pathname,n=e.children[1];if(!n||!n.children.length||!t.startsWith("/orgs/"))return;const o=n.children[0];if(!o)return;const s=m(o,E);if(s.style.paddingLeft="5px",t.split("/").includes("teams"))n.insertBefore(s,n.children[1]),s.style.paddingLeft="5px",s.style.paddingRight="12px",s.style.verticalAlign="text-bottom";else{const e=document.createElement("span");e.style.display="flex",n.insertBefore(e,o),e.appendChild(o),e.appendChild(s)}},x=(e,t)=>{const n=document.getElementsByClassName(e);if(n)for(let e=0;e<n.length;++e){const o=n[e];o&&(0===o.getElementsByClassName(l).length&&t(o))}},N=()=>{clearTimeout(d),x("timeline-comment-actions",h),x("js-commits-list-item",f),x("float-right",y),x("pagehead-actions",b),x("member-list-item",v),d=setTimeout(N,3e3)},C=(e,t)=>{for(const{removedNodes:t}of e)for(const e of t){if(e.nodeType!==Node.ELEMENT_NODE)continue;const t=e;if(t.classList.contains("timeline-comment-header"))return void N();if(t.hasChildNodes()){const e=t.getElementsByClassName("timeline-comment-header");if(e&&e.length>0)return void N()}}},M=document.getElementById("discussion_bucket");M&&new MutationObserver(C).observe(M,{childList:!0,subtree:!0});let T="";const B=e=>{e&&(e.url||"complete"===e.status)&&location.href!==T&&(T=location.href,N())};var I;chrome.extension.inIncognitoContext||(I=e=>{e?(s()?N():document.addEventListener("readystatechange",(function(){s()&&N()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&N()})),((e,t)=>{if(o)return;o=!0;const s=n();s&&(s.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),s.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(i,B)):console.error("Failed to initialize communications port")},t?I(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),I(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),I(!0))}),100)),console.info("Greaselion script loaded: githubInlineTipping.ts"))})();